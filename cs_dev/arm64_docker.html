<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- This manual is for Document, version 1.0.

Copyright C years free time team.

Permission is granted to

 -->
<!-- Created on August 28, 2022 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>ARM64 Env</title>

<meta name="description" content="ARM64 Env">
<meta name="keywords" content="ARM64 Env">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Top"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="ARM64-env-on-X86-docker"></a>
<h1 class="settitle">ARM64 env on X86 docker</h1>

<p>This manual is for program, version version.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Docker-Usage-Introduction">1. Docker Usage Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Get-and-Run-ARM64-Docker">2. Get and Run ARM64 Docker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#ARM64-code-sample">3. ARM64 code sample</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="1">
<a name="Docker-Usage-Introduction"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Get-and-Run-ARM64-Docker" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Get-and-Run-ARM64-Docker" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Docker-Usage-Introduction-1"></a>
<h1 class="chapter">1. Docker Usage Introduction</h1>
<p>以下几篇文章可以作为 Docker 的通用入门文章
</p><table><tr><td>&nbsp;</td><td><pre class="example">https://www.runoob.com/docker/ubuntu-docker-install.html
https://www.runoob.com/docker/docker-image-usage.html
</pre></td></tr></table>


<hr size="6">
<a name="Get-and-Run-ARM64-Docker"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Docker-Usage-Introduction" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#ARM64-code-sample" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Docker-Usage-Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#ARM64-code-sample" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Get-and-Run-ARM64-Docker-1"></a>
<h1 class="chapter">2. Get and Run ARM64 Docker</h1>

<p>使用以下两条命令，你就可以在x86 ubuntu的环境中搭建起一个arm64的学习环境了。
</p><table><tr><td>&nbsp;</td><td><pre class="example">sudo docker pull ft2team/arm64_u20.04:sve
sudo docker run --rm -v ~/:/mnt -it ft2team/arm64_u20.04:sve
</pre></td></tr></table>


<hr size="6">
<a name="ARM64-code-sample"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Get-and-Run-ARM64-Docker" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[ &gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Get-and-Run-ARM64-Docker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="ARM64-code-sample-1"></a>
<h1 class="chapter">3. ARM64 code sample</h1>

<p><b>AARCH64 基本汇编程序</b>
</p>
<p>切换到目录 ~/aarch64_sample/aarch64_asm，有一个内置的 aarch64 的基本汇编测试程序，如下
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ cat hello.S
        .arch armv8-a
        .text
        .align  2

        .global main
        .type   main, %function
main:
        stp     x29, x30, [sp, -16]!

        adrp    x0, hello_str
        add     x0, x0, :lo12:hello_str
        bl      printf
        mov     x0, 0

        ldp     x29, x30, [sp], 16
        ret

        .section        .rodata
        .align  4
hello_str:
        .string &quot;hello aarch64\n&quot;
</pre></td></tr></table>


<p>执行 makefile 文件可以得到如下结果
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ make run clean
gcc     hello.S   -o hello
./hello
hello aarch64
rm -f hello *.o
</pre></td></tr></table>


<p><b>AARCH64 Neon指令</b>
</p>
<p>Neon 的测试代码在目录 ~/aarch64_sample/neon 下面。
AARCH64 Neon 汇编编译运行
</p>
<p>这是一个批量处理16个 unsigned char 类型数据做加法运算的例子，运行 make run_asm clean 结果如下
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ make run_asm clean
cc    -c -o neon_add3.o neon_add3.S
cc -g -Wall -march=armv8.2-a -O2   -c -o neon_add3_test.o neon_add3_test.c
cc   neon_add3.o neon_add3_test.o   -o neon_add3
./neon_add3
name: data
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
name: data (new)
3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
rm -f *.o neon_add3 neon_hello
</pre></td></tr></table>


<p><b>AARCH64 Neon intrinsics</b>
</p>
<p>这是一个用neon计算 1,2,3 ... 加到99 的例子，运行 make run_intrinsics clean 结果如下
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ make run_intrinsics clean
cc -g -Wall -march=armv8.2-a -O2   -c -o neon_hello.o neon_hello.c
cc   neon_hello.o   -o neon_hello
./neon_hello
sum=4950
rm -f *.o neon_add3 neon_hello
</pre></td></tr></table>


<p><b>AARCH64 SVE</b>
</p>
<p>SVE 的测试代码在目录 ~/work/sve 下面。
AARCH64 SVE 汇编编译运行
</p>
<p>这是通过sve指令计算字符串长度的例子，运行 make run_asm clean 结果如下
</p>
<p>注意: arm sve 指令是 armv8.2 开始支持的，因此 -march 后面的参数是: armv8.2-a+sve
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ make run_asm clean
cc    -c -o sve_strlen.o sve_strlen.S
/home/dev/bin/gcc_sve/bin/aarch64-linux-gnu-gcc -g -Wall -march=armv8.2-a+sve -O2 -c -o sve_strlen_test.o sve_strlen_test.c
cc   sve_strlen.o sve_strlen_test.o   -o sve_strlen
./sve_strlen
len=9 of &quot;hello sve&quot;
rm -f *.o sve_strlen sve_hello
</pre></td></tr></table>


<table><tr><td>&nbsp;</td><td><pre class="example">$ cat sve_strlen.S
// reference: https://alastairreid.github.io/papers/sve-ieee-micro-2017.pdf
        .arch armv8.2-a+sve
        .text
        .align  2

        .global sve_strlen
        .type   sve_strlen, %function

sve_strlen:
        mov x1, x0
        ptrue p0.b
.loop:
        setffr
        ldff1b z0.b, p0/z, [x1]
        rdffr p1.b, p0/z
        cmpeq p2.b, p1/z, z0.b, #0
        brkbs p2.b, p1/z, p2.b
        incp x1, p2.b
        b.last .loop
        sub x0, x1, x0
ret
</pre></td></tr></table>


<p>AARCH64 SVE intrinsics 编译运行
</p>
<p>这是一个通过 sve intrinsics 做批量运算的例子，运行 make run_intrinsics clean 结果如下
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ make run_intrinsics clean
/home/dev/bin/gcc_sve/bin/aarch64-linux-gnu-gcc -g -Wall -march=armv8.2-a+sve -O2 -c -o sve_hello.o sve_hello.c
cc   sve_hello.o   -o sve_hello
./sve_hello
0.988095 0.988095 0.988095, 0.000000, 0.988095
1.488095 1.488095 1.488095, 0.500000, 0.988095
1.654762 1.654762 1.654762, 0.666667, 0.988095
1.738095 1.738095 1.738095, 0.750000, 0.988095
1.788095 1.788095 1.788095, 0.800000, 0.988095
1.821429 1.821429 1.821429, 0.833333, 0.988095
1.845238 1.845238 1.845238, 0.857143, 0.988095
1.863095 1.863095 1.863095, 0.875000, 0.988095
1.876984 1.876984 1.876984, 0.888889, 0.988095
1.888095 1.888095 1.888095, 0.900000, 0.988095
rm -f *.o sve_strlen sve_hello
</pre></td></tr></table>


<hr size="6">
<a name="SEC_Contents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Table of Contents</h1>
<div class="contents">

<ul class="toc">
  <li><a name="toc-Docker-Usage-Introduction-1" href="#Docker-Usage-Introduction">1. Docker Usage Introduction</a></li>
  <li><a name="toc-Get-and-Run-ARM64-Docker-1" href="#Get-and-Run-ARM64-Docker">2. Get and Run ARM64 Docker</a></li>
  <li><a name="toc-ARM64-code-sample-1" href="#ARM64-code-sample">3. ARM64 code sample</a></li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[Index]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>About This Document</h1>
<p>
  This document was generated by <em>zzy</em> on <em>August 28, 2022</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
</p>
<p>
  The buttons in the navigation panels have the following meaning:
</p>
<table border="1">
  <tr>
    <th> Button </th>
    <th> Name </th>
    <th> Go to </th>
    <th> From 1.2.3 go to</th>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Back</td>
    <td>Previous section in reading order</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Forward</td>
    <td>Next section in reading order</td>
    <td>1.2.4</td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">FastBack</td>
    <td>Beginning of this chapter or previous chapter</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [ Up ] </td>
    <td align="center">Up</td>
    <td>Up section</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">FastForward</td>
    <td>Next chapter</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [Top] </td>
    <td align="center">Top</td>
    <td>Cover (top) of document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Contents] </td>
    <td align="center">Contents</td>
    <td>Table of contents</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>Index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">About</td>
    <td>About (help)</td>
    <td> &nbsp; </td>
  </tr>
</table>

<p>
  where the <strong> Example </strong> assumes that the current position is at <strong> Subsubsection One-Two-Three </strong> of a document of the following structure:
</p>

<ul>
  <li> 1. Section One
    <ul>
      <li>1.1 Subsection One-One
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Subsection One-Two
        <ul>
          <li>1.2.1 Subsubsection One-Two-One</li>
          <li>1.2.2 Subsubsection One-Two-Two</li>
          <li>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp;
            <strong>&lt;== Current Position </strong></li>
          <li>1.2.4 Subsubsection One-Two-Four</li>
        </ul>
      </li>
      <li>1.3 Subsection One-Three
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Subsection One-Four</li>
    </ul>
  </li>
</ul>

<hr size="1">
<p>
 <font size="-1">
  This document was generated by <em>zzy</em> on <em>August 28, 2022</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>
</body>
</html>
